{"version":3,"sources":["../src/query_editor.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAQ;;AAED;;;;;;;;;;;;;;;;;;;;;yCAED;;;AAEJ,iBAFI,uBAEJ,CAAY,MAAZ,EAAoB,SAApB,EAA+B,YAA/B,EAA6C;gCAFzC,yBAEyC;;6EAFzC,oCAGI,QAAQ,YAD6B;;AAG3C,gBAAK,YAAL,GAAoB,YAApB,CAH2C;AAI3C,gBAAK,kBAAL,GAA0B,MAAK,YAAL,CAAkB,UAAlB,CAA6B,EAAC,MAAM,IAAN,EAAY,OAAO,qBAAP,EAA1C,CAA1B,CAJ2C;;AAM3C,gBAAK,MAAL,CAAY,OAAZ,GAAsB,MAAK,MAAL,CAAY,OAAZ,IAAuB,EAAvB,CANqB;AAO3C,gBAAK,MAAL,CAAY,QAAZ,GAAuB,MAAK,MAAL,CAAY,QAAZ,IAAwB,KAAxB,CAPoB;;AAS3C,gBAAK,cAAL,GAAsB,MAAK,MAAL,CAAY,OAAZ,CAAoB,GAApB,CAAwB,gBAAQ;AACpD,mBAAO,MAAK,YAAL,CAAkB,UAAlB,CAA6B,EAAC,OAAO,KAAK,IAAL,EAAW,UAAU,MAAV,EAAhD,CAAP,CADoD;WAAR,CAA9C,CAT2C;;AAa3C,gBAAK,cAAL,CAAoB,IAApB,CAAyB,MAAK,YAAL,CAAkB,aAAlB,EAAzB,EAb2C;;SAA7C;;qBAFI;;4CAkBc,SAAS;;;AACzB,mBAAO,KAAK,UAAL,CAAgB,UAAhB,GAA6B,IAA7B,CAAkC,mBAAW;AAClD,kBAAI,WAAW,QAAQ,GAAR,CAAY,gBAAQ;AACjC,uBAAO,OAAK,YAAL,CAAkB,UAAlB,CAA6B,EAAC,OAAO,KAAK,KAAL,EAArC,CAAP,CADiC;eAAR,CAAvB,CAD8C;;AAKlD,kBAAI,CAAC,QAAQ,IAAR,EAAc;AACjB,yBAAS,OAAT,CAAiB,EAAE,KAAF,CAAQ,OAAK,kBAAL,CAAzB,EADiB;eAAnB;;AAIA,qBAAO,QAAP,CATkD;aAAX,CAAzC,CADyB;;;;4CAcT;AAChB,iBAAK,SAAL,CAAe,UAAf,CAA0B,IAA1B,GADgB;AAEhB,iBAAK,SAAL,CAAe,UAAf,CAA0B,KAA1B,GAFgB;;;;+CAKG,SAAS,OAAO;AACnC,gBAAI,QAAQ,KAAR,KAAkB,KAAK,kBAAL,CAAwB,KAAxB,EAA+B;AACnD,mBAAK,cAAL,CAAoB,MAApB,CAA2B,KAA3B,EAAkC,CAAlC,EADmD;aAArD,MAEO;AACL,kBAAI,QAAQ,IAAR,KAAiB,aAAjB,EAAgC;AAClC,wBAAQ,IAAR,GAAe,EAAf,CADkC;eAApC;;AAIA,kBAAI,KAAC,GAAM,CAAN,KAAa,KAAK,cAAL,CAAoB,MAApB,EAA4B;AAC5C,qBAAK,cAAL,CAAoB,IAApB,CAAyB,KAAK,YAAL,CAAkB,aAAlB,EAAzB,EAD4C;eAA9C;aAPF;;AAYA,iBAAK,MAAL,CAAY,OAAZ,GAAsB,KAAK,cAAL,CAAoB,MAApB,CAA2B,UAAC,IAAD,EAAO,IAAP,EAAgB;AAC/D,kBAAI,CAAC,KAAK,IAAL,EAAW;AACd,qBAAK,IAAL,CAAU,EAAC,MAAM,KAAK,KAAL,EAAjB,EADc;eAAhB;AAGA,qBAAO,IAAP,CAJ+D;aAAhB,EAK9C,EALmB,CAAtB,CAbmC;;AAoBnC,gBAAI,KAAK,MAAL,CAAY,OAAZ,CAAoB,MAApB,GAA6B,CAA7B,EAAgC;AAClC,mBAAK,SAAL,CAAe,UAAf,CAA0B,KAA1B,GADkC;aAApC,MAEO;AACL,mBAAK,SAAL,CAAe,UAAf,CAA0B,IAA1B,GADK;aAFP;;;;eAzDE;QAAgC;;AAiEtC,8BAAwB,WAAxB,GAAsC,qBAAtC;;yCACQ","file":"query_editor.js","sourcesContent":["import {QueryCtrl} from 'app/plugins/sdk';\n\nimport _ from 'lodash';\n\nclass PrometheusPullQueryCtrl extends QueryCtrl {\n\n  constructor($scope, $injector, uiSegmentSrv) {\n    super($scope, $injector);\n\n    this.uiSegmentSrv = uiSegmentSrv;\n    this.removeMetricOption = this.uiSegmentSrv.newSegment({fake: true, value: '-- remove metric --'});\n\n    this.target.metrics = this.target.metrics || [];\n    this.target.interval = this.target.interval || '10s';\n\n    this.metricSegments = this.target.metrics.map(item => {\n      return this.uiSegmentSrv.newSegment({value: item.name, cssClass: 'last'});\n    });\n\n    this.metricSegments.push(this.uiSegmentSrv.newPlusButton());\n  }\n\n  getMetricSegments(segment) {\n    return this.datasource.getMetrics().then(metrics => {\n      var elements = metrics.map(item => {\n        return this.uiSegmentSrv.newSegment({value: item.value});\n      });\n\n      if (!segment.fake) {\n        elements.unshift(_.clone(this.removeMetricOption));\n      }\n\n      return elements;\n    });\n  }\n\n  intervalChanged() {\n    this.panelCtrl.dataStream.stop();\n    this.panelCtrl.dataStream.start();\n  }\n\n  metricSegmentChanged(segment, index) {\n    if (segment.value === this.removeMetricOption.value) {\n      this.metricSegments.splice(index, 1);\n    } else {\n      if (segment.type === 'plus-button') {\n        segment.type = '';\n      }\n\n      if ((index+1) === this.metricSegments.length) {\n        this.metricSegments.push(this.uiSegmentSrv.newPlusButton());\n      }\n    }\n\n    this.target.metrics = this.metricSegments.reduce((memo, item) => {\n      if (!item.fake) {\n        memo.push({name: item.value});\n      }\n      return memo;\n    }, []);\n\n    if (this.target.metrics.length > 0) {\n      this.panelCtrl.dataStream.start();\n    } else {\n      this.panelCtrl.dataStream.stop();\n    }\n  }\n}\n\nPrometheusPullQueryCtrl.templateUrl = './query_editor.html';\nexport {PrometheusPullQueryCtrl};\n"]}